<!DOCTYPE HTML>
<!--
	Twenty 1.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SERVIR-Project</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.dropotron.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-wide.css" />
			<link rel="stylesheet" href="css/style-noscript.css" />
		</noscript>
    
    <!--- ADDED -->
    <link rel="stylesheet" href="http://openlayers.org/en/v3.10.1/css/ol.css" type="text/css">
    <link rel="stylesheet" href="http://rawgit.com/walkermatt/ol3-layerswitcher/master/src/ol3-layerswitcher.css" type="text/css">
    <style>
   
      .map {
        width: 100%;
        height: 80%;
        float: top;
      }
    

      
    </style>
    <script src="http://openlayers.org/en/v3.10.1/build/ol.js" type="text/javascript"></script>
   
	</head>
	
	<body class="contact loading" onload="initializeOnFirstPageLoading()">

		<!-- Header -->
			<header id="header">
				<h1 id="logo"><a href="index.html"><font color="red">SERVIR-Mekong <span> Project</span></font></a></h1>
				<nav id="nav">
					<ul>
						<li class="current"><a href="index.html" class="button special">Home</a></li>
						<li class="current"><a href="floodMap.html">Flood Map</a></li>
					</ul>
				</nav>
			</header>
			
	<div style=" top: 55px; width: 100%; height: 30px; position: absolute; z-index: 1; text-align: center;">
		<div name ="sliderDIV" id="sliderDIV">
			<b>Change Transparency of Selected Layer: </b>
			<select id="layerID" onchange="updateLayerTransparency()">
				<option value=""> Choose Layer </option>
				<option value="lc2005"> Land Cover 2005 </option>
				<option value="lc2009"> Land Cover 2009 </option>
				<option value="lc2016"> Land Cover 2016 </option>
				<option value="HRSL2015"> HRSL 2015</option>
				<option value="worldPop"> WorldPop 2010 </option>
				<option value="flood2011"> Flood 2011 </option>				
				<option value="cities"> Provinces</option>
				
			</select>
				<input type="range" id = "sliderID" name="slider1" value="0" min="0" max="100"/>

		</div>
	</div>

	<div class="container-fluid">
    <div class="row-fluid">
	
    <div id="map" class="map" style=" top: 95px; width: 100%; height: auto; position: absolute; z-index: 1;">
	
		<div id="worldPop2010" style="z-index: 2; position: absolute; top: 100px; left: 20px; background-position:100px 200px; height:250px; width:500px;">
		<b><font color="#000000">WorldPop 2010(person/100 sq.meters):</font></b><br>
		  <img src="http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?service=WMS&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=12&HEIGHT=12&LAYER=servir:bkkAreaPopulationWorldPop2010">
		</div>
		<div id="hrsl2010"  style="z-index: 2;  position: absolute; top: 240px; left: 20px; background-position:100px 200px; height:250px; width:500px;">
		<b><font color="#000000">Population HRSL (person/30 sq.meters):</font></b><br>
		  <img src="http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?service=WMS&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=12&HEIGHT=12&LAYER=servir:bangkokMetroPopHRSL2015">
		</div>
		
		<div id="lc-class" style="z-index: 2; position: absolute; top: 380px; left: 20px; background-position:100px 200px; height:250px; width:500px;">
		<b><font color="#000000">Land Cover 2005:</font></b><br>
		  <img src="http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?service=WMS&REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=12&HEIGHT=12&LAYER=servir:lc2005">
		</div>
		
		
		
	</div>

	
    <script src="http://rawgit.com/walkermatt/ol3-layerswitcher/master/src/ol3-layerswitcher.js" type="text/javascript"></script>
    <script src="js/landcoverlayers.js" type="text/javascript"></script>
    <script type="text/javascript">
	 // START: code to change transparency of layer

		var $slider = $('input[name="slider1"]');
		
		var valueHRSL = 100;
		var valueWorldPop = 100;
		var valueCities = 100;
		var valueFlood2011 = 100;
		var valueLC2005 = 100;
		var valueLC2009 = 100;
		var valueLC2016 = 100;
		
		
		// change Layer transparency based on the slider movement
		$slider.bind('change', function(e) {
			var sliderValue = ($(this).val()/100);
			var LayerName = getSelectedText('layerID');
			//alert("slider moved");
			
			if( LayerName=="HRSL2015")
			{
				HRSL2015.setOpacity(sliderValue);
				valueHRSL =  sliderValue;
				
				HRSL2015.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
				showLegend(document.getElementById('hrsl2010')) ;// hrsl2010 is the div ID of the legend for this layer              
			}
			else if (LayerName =="worldPop")
			{
					worldPop.setOpacity(sliderValue);
					valueWorldPop = sliderValue;
					
					worldPop.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
					showLegend(document.getElementById('worldPop2010')) ;// worldPop2010 is the div ID of the legend for this layer
			}
			else if (LayerName =="cities")
			{
					cities.setOpacity(sliderValue);
					valueCities = sliderValue;
					cities.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement					
			}
			else if (LayerName =="flood2011")
			{
					flood2011.setOpacity(sliderValue);
					valueFlood2011 = sliderValue;
					flood2011.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
			
			}	
			else if (LayerName =="lc2005")
			{
					lc2005.setOpacity(sliderValue);
					valueLC2005 = sliderValue;
					lc2005.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
					showLegend(document.getElementById('lc-class')) ;// lc-class is the div ID of the legend for this layer
			
			}	
			else if (LayerName =="lc2009")
			{
					lc2009.setOpacity(sliderValue);
					valueLC2009 = sliderValue;
					lc2009.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
					showLegend(document.getElementById('lc-class')) ;// lc-class is the div ID of the legend for this layer
			}	
			else if (LayerName =="lc2016")
			{
					lc2016.setOpacity(sliderValue);
					valueLC2016 = sliderValue;
					lc2016.setVisible(true);// Layer is made visible, if its transparency is changed by slider movement		
					showLegend(document.getElementById('lc-class')) ;// lc-class is the div ID of the legend for this layer
			}						
			
		});
		
		
		function updateLayerTransparency()
		{
			var slider = document.getElementById('sliderID');
			var LayerName = getSelectedText('layerID');
			if( LayerName=="HRSL2015")
			{
				HRSL2015.setOpacity(valueHRSL);				
				slider.value = valueHRSL *100;	
				
				//HRSL2015.setVisible(true); // set the layer visible if its selected for setting transparency
								
			}
			else if (LayerName =="worldPop")
			{
					worldPop.setOpacity(valueWorldPop);
					slider.value = valueWorldPop *100;
					
			}
			else if (LayerName =="cities")
			{
					cities.setOpacity(valueCities);
					slider.value = valueCities *100;
					
			}	
			else if (LayerName =="flood2011")
			{
					flood2011.setOpacity(valueFlood2011);
					slider.value = valueFlood2011 *100;
					
			}
			else if (LayerName =="lc2005")
			{
					lc2005.setOpacity(valueLC2005);
					slider.value = valueLC2005 *100;
					
			}
			else if (LayerName =="lc2009")
			{
					lc2009.setOpacity(valueLC2009);
					slider.value = valueLC2009 *100;
					
			}
			else if (LayerName =="lc2016")
			{
					lc2016.setOpacity(valueLC2016);
					slider.value = valueLC2016 *100;
					
			}
			
		}

		function getSelectedText(elementId) {
			var elt = document.getElementById(elementId);

			if (elt.selectedIndex == -1)
				return null;
			
			
			return ( elt.options[elt.selectedIndex].value);
			
		
		}
// END: code to change transparency of layer	
		
		
		
	  var pathum = ol.proj.transform([100.6131819961167,13.81328489039565], 'EPSG:4326', 'EPSG:3857');
      var view = new ol.View({
        center:  pathum,
        zoom: 9,
		minZoom: 3,
		maxZoom: 20
      });
      
        var map = new ol.Map({
        controls: ol.control.defaults().extend([
	      new ol.control.ScaleLine(),
	      new ol.control.OverviewMap(),
          new ol.control.FullScreen({
            source: 'fullscreen'
          })
        ]),
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        target: 'map',
	    view: view
      });



	
//////////////////////////////////////////////////function	
	function doBounce(location) {
        // bounce by zooming out one level and back in
        var bounce = ol.animation.bounce({
          resolution: map.getView().getResolution() * 3
        });
	 // start the pan at the current center of the map
        var pan = ol.animation.pan({
          source: map.getView().getCenter()
        });
        map.beforeRender(bounce);
        map.beforeRender(pan);
        // when we set the center to the new location, the animated move will
        // trigger the bounce and pan effects
        map.getView().setCenter(location);
      }
	
/////////////////////////////////////////////////////////////////////////////////////	

		var cities = new ol.layer.Vector({
			title: 'Provinces',
			source: new ol.source.Vector({
				format: new ol.format.KML({extractStyles:false}),
				url: 'cities.kml'
			}),
			
			style: new ol.style.Style({				
	
				
				fill: new ol.style.Fill({
					color: 'rgba(255,255,255,0.5)'
				}),
				stroke: new ol.style.Stroke({
				color: '#ffcc33',
				width: 2
				}),
				
				image: new ol.style.Circle({
				radius: 3,
				fill: new ol.style.Fill({
					color:'#000000'
				})
				})	
			}),
			visible: false
		      }); 
		      
		 
		 
		      
		      
		// MapQuest streets
		var osmBase = new ol.layer.Tile({
		  //title: 'Open Street Map',
		  group: "background",
		  source: new ol.source.MapQuest({layer: 'osm'})
		})
/////////////////////////////////////////////////////////////////////////////////////
		

		var worldPop = new ol.layer.Tile({title: 'Population(2010 Est. by WorldPop)',
			source: new ol.source.TileWMS ({
				url: 'http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?',
				//params:{'LAYERS':'servir:THA_pph_v2b_2010','TILED': true},
				params:{'LAYERS':'servir:bkkAreaPopulationWorldPop2010','TILED': true},
				serverType: 'geoserver'			
		})
		});
		
		var HRSL2015 = new ol.layer.Tile({title: 'Population(2015 Est. by HRSL)',
			source: new ol.source.TileWMS ({
				url: 'http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?',
				//params:{'LAYERS':'servir:bangkokMetroPopHRSL2015','TILED': true},
				params:{'LAYERS':'servir:bangkokMetroPopHRSL2015','TILED': true},
				serverType: 'geoserver'			
			})		
		,visible: false
		});
		
		
		var flood2011  = new ol.layer.Tile({title: '2011 Flooded areas by GISTDA',
			source: new ol.source.TileWMS ({
				url: 'http://guam.csis.u-tokyo.ac.jp:8080/geoserver/servir/wms?',
				params:{'LAYERS':'servir:bkkMetroFlood2011','TILED': true},
				serverType: 'geoserver'			
			})		
		});
		
		// register the layer so that the layer selection event is captured for toggling their corresponding Legend
		HRSL2015.on('change:visible', function(){
			//alert("HRSL2015");
			showHideLegend(document.getElementById('hrsl2010')) ;
			
		});
		
		worldPop.on('change:visible', function(){
			
			showHideLegend(document.getElementById('worldPop2010')) ;
		});
		
		// lc-class needs to be visible if any of the three LC layer are visible
		var lc2016Visible = 0;
		var lc2009Visible = 0;
		var lc2005Visible = 0;
		
		lc2016.on('change:visible', function(){		
			
			if (lc2016Visible != 1){
				lc2016Visible = 1;
			}	
			else{
				lc2016Visible = 0;
			}
			
			showHideLegend4LC(document.getElementById('lc-class')) ;
		});
		
		lc2009.on('change:visible', function(){			
			if (lc2009Visible != 1){
				lc2009Visible = 1;
			}	
			else{
				lc2009Visible = 0;
			}
			showHideLegend4LC(document.getElementById('lc-class')) ;
		});
		
		lc2005.on('change:visible', function(){			
			if (lc2005Visible != 1){
				lc2005Visible = 1;
			}	
			else{
				lc2005Visible = 0;
			}
			showHideLegend4LC(document.getElementById('lc-class')) ;
		});
		
		
		function showHideLegend4LC(divID) { // toggle layer specific legend based on the selection of the corresponding layer
			
			if( (lc2005Visible == 1) || (lc2009Visible ==1) || (lc2016Visible==1)){
				divID.style.display = 'block';
			}
			else{
				divID.style.display = 'none';
			}			
		}
		
		function showHideLegend(divID) { // toggle layer specific legend based on the selection of the corresponding layer
			//var x = document.getElementById('myDIV');
			if (divID.style.display == 'none') {
				divID.style.display = 'block';
			} else {
				divID.style.display = 'none';
			}
		}
		
		function showLegend(divID) { // show layer specific legend 
			
			divID.style.display = 'block';
			
		}
		
		function showHideLayer1(layerID) { // show hide layer
		
			var visibility = layerID.getVisible();
				  if (visibility == false) {
					//layerID.setVisible(true);
					alert('visible');
				  }
				  if (visibility == true) {
					//layerID.setVisible(false);
					alert('hidden');
				  }
		}

		function initializeOnFirstPageLoading(){
			// hide  legend images for unselected layers			
			
			hideLegend(document.getElementById('hrsl2010')) ;
			hideLegend(document.getElementById('lc-class')) ;
			
		}
		
		
		function hideLegend(divID){			
			divID.style.display = 'none';
			
		}
			
		map.addLayer(osmBase);
		map.addLayer(cities);	
		map.addLayer(flood2011);	
		map.addLayer(worldPop);
		map.addLayer(HRSL2015);
		map.addLayer(lc2016);
		map.addLayer(lc2009);
		map.addLayer(lc2005);
	
	
        var layerSwitcher = new ol.control.LayerSwitcher({
              tipLabel: 'L?gende' // Optional label for button
        });
        map.addControl(layerSwitcher);
        

    </script>
		
		

	</body>
</html>
